<?xml version="1.0" ?><jasbro.game.world.customContent.WorldEvent><id>contestQuestBartenderContest</id><triggers></triggers><effects><jasbro.game.world.customContent.effects.WorldEventEffectContainer><subEffects><jasbro.game.world.customContent.effects.WorldEventLoadVariable><source>difficulty</source><target>difficulty</target></jasbro.game.world.customContent.effects.WorldEventLoadVariable><jasbro.game.world.customContent.effects.WorldEventLoadVariable><source>bonusPointsVersion</source><target>bonusPointsVersion</target></jasbro.game.world.customContent.effects.WorldEventLoadVariable><jasbro.game.world.customContent.effects.WorldEventCode><code>//calculate max-prices
int priceMoney = 0;
int skillPoints = 0;
if (difficulty == 1) {
  priceMoney =  10000;
}
else if (difficulty == 2) {
  priceMoney = 100000;
  skillPoints = 1;
}
else {
  priceMoney = 1000000;
  skillPoints = 3;
}</code><displayHeight>2</displayHeight></jasbro.game.world.customContent.effects.WorldEventCode><jasbro.game.world.customContent.effects.WorldEventCode><code>int score = 0;
score += character.getFinalValue(BaseAttributeTypes.CHARISMA) / 4;
score += character.getFinalValue(BaseAttributeTypes.INTELLIGENCE) / 4;
score += character.getFinalValue(SpecializationAttribute.BARTENDING);

if (bonusPointsVersion == 1) {
  score += character.getFinalValue(BaseAttributeTypes.INTELLIGENCE) * 4;
}
else {
  score += character.getFinalValue(SpecializationAttribute.COOKING);
}

int targetScore = difficulty * difficulty * 100;

int place;
if (score &gt; targetScore) {
  place = 1;
}
else {
  skillPoints = 0;
  if (score &gt; targetScore * 19 / 20) {
    place = 2;
    priceMoney = priceMoney / (place * place * difficulty);
  }
  else if (score &gt; targetScore * 18 / 20) {
    place = 3;
    priceMoney = priceMoney  / (place * place * difficulty);
  }
  else if (score &gt; targetScore * 16 / 20) {
    place = 4;
    priceMoney = priceMoney / (place * place * difficulty);
  }
  else if (score &gt; targetScore * 13 / 20) {
    place = 5;
    priceMoney = priceMoney / (place * place * difficulty);
  }
  else {
    place = 6;
    priceMoney = 0;
    if (difficulty &gt;= 3) {
      place += Util.getInt(0, 10);
    }
  }
}

for (int i = 0; i &lt; skillPoints; i++) {
  character.addBonusPerk();
}
character.fame.modifyFame(priceMoney / 20);
data.protagonist.fame.modifyFame(priceMoney / 100);</code><displayHeight>7</displayHeight></jasbro.game.world.customContent.effects.WorldEventCode><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt; participates in todays bartending contest. The event takes place in a small, shady looking bar. Most of the patrons seem to be there more by accident than to watch the contest.</message><images><jasbro.game.world.customContent.ImageSelection><image>bartenderContest.jpg</image><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>BARTEND</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/bar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>true</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt; participates in todays bartending contest. The event takes place in a well known bar in the richer parts of the city. The bar owner briefly announces the event, while the part of his bartenders, who are working normally today, serve drinks among the cheering and laughing crowd.</message><images><jasbro.game.world.customContent.ImageSelection><image>bartenderContest.jpg</image><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>MAID</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/bar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>true</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt; participates in todays bartending championship. The event takes place in a huge hall for important events and is sponsored by some of the best endowed bar owners of the city. While one of them announces the event, &lt;c.name&gt; and the other contenders are being cheered on by the huge crowd.</message><images><jasbro.game.world.customContent.ImageSelection><image>bartenderContest.jpg</image><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>MAID</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/bar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>true</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return difficulty == 2;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return difficulty &lt;= 1;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt; did an excellent job during the bartending part of the event. &lt;c.hisHer&gt; customers were constantly served top notch drinks. &lt;c.heShe&gt; got high praises across the board.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>BARTEND</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/bar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt;'s bartending skills were good, but &lt;c.hisher&gt; customers were not entirely convinced by her drinks. Quite an average result.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>BARTEND</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/bar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt;'s patrons had to wait quite a while for being served at all. &lt;c.heShe&gt; got very bad marks at the end.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>BARTEND</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/bar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return character.getFinalValue(SpecializationAttribute.BARTENDING) &gt; targetScore * 2 / 5;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return character.getFinalValue(SpecializationAttribute.BARTENDING) &gt; targetScore * 3 / 5;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt; was able to serve dozens of customers at the same time and still have a meaningfull conversation with them. &lt;c.heShe&gt; was always able to pick the previous train of thought back up when returning to a table and never got confused between customers.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>BARTEND</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/trainerbar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt; did a reasonable job in the conversational part of the contest. &lt;c.heShe&gt; was able to make smalltalk with most of her customers.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>BARTEND</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/trainerbar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;c.name&gt; did a dreadful job during the conversational part of the contest. &lt;c.heShe&gt; got confused between customers and her conversation skills were frowned upon.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>BARTEND</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/trainerbar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return character.getFinalValue(BaseAttributeTypes.INTELLIGENCE) * 4 &gt; targetScore * 2 / 5;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return character.getFinalValue(BaseAttributeTypes.INTELLIGENCE) * 4 &gt; targetScore * 3 / 5;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>The snacks &lt;c.name&gt; prepared were absolutely delicious and regarded highly by everyone.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>COOK</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/trainerbar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>The snacks &lt;c.name&gt; prepared were alright for the most part. &lt;c.heShe&gt; got average marks.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>COOK</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/trainerbar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>The patrons were disgusted with the snacks &lt;c.name&gt; served. Seems like &lt;c.heshe&gt; really can't cook.</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>COOK</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>backgrounds/trainerbar.jpg</image><imageLocation>GLOBAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>false</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return character.getFinalValue(SpecializationAttribute.COOKING) &gt; targetScore * 2 / 5;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return character.getFinalValue(SpecializationAttribute.COOKING) &gt; targetScore * 3 / 5;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return bonusPointsVersion == 1;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition><jasbro.game.world.customContent.effects.WorldEventCondition><subEffects><jasbro.game.world.customContent.effects.WorldEventEffectContainer><subEffects><jasbro.game.world.customContent.effects.WorldEventCode><code>String message = "Under standing ovations &lt;c.name&gt; gets handed the trophy for first place.";
if (skillPoints &gt; 0) {
  message += TextUtil.getInstance().insertObjects(" &lt;c.heShe&gt; won {0} gold and her overall skill improved (+{1} perks).", new Object[] {priceMoney, skillPoints});
}
else {
  message += TextUtil.getInstance().insertObjects(" &lt;c.heShe&gt; won {0} gold.", new Object[] {priceMoney});
}
message += " In addition to that many people will talk about you and &lt;c.name&gt; for a while.";
message = TextUtil.getInstance().applyTemplates(message, characters);</code><displayHeight>2</displayHeight></jasbro.game.world.customContent.effects.WorldEventCode><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;message&gt;</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>bartenderContest2.jpg</image><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>true</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage></subEffects></jasbro.game.world.customContent.effects.WorldEventEffectContainer><jasbro.game.world.customContent.effects.WorldEventEffectContainer><subEffects><jasbro.game.world.customContent.effects.WorldEventCode><code>String message = null;
if (priceMoney &gt; 0) {
  message = TextUtil.getInstance().insertObjects(" &lt;c.heShe&gt; made {0}. place and won {1} gold.", new Object[] {place, priceMoney});
}
else {
  message = TextUtil.getInstance().insertObjects(" &lt;c.name&gt; only got {0}th place.", new Object[] {place});
}
message = TextUtil.getInstance().applyTemplates(message, characters);</code><displayHeight>2</displayHeight></jasbro.game.world.customContent.effects.WorldEventCode><jasbro.game.world.customContent.effects.WorldEventSimpleMessage><message>&lt;message&gt;</message><images><jasbro.game.world.customContent.ImageSelection><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></jasbro.game.world.customContent.ImageSelection></images><background><image>bartenderContest2.jpg</image><imageLocation>LOCAL</imageLocation><imageTags><jasbro.gui.pictures.ImageTag>STANDARD</jasbro.gui.pictures.ImageTag></imageTags><background>false</background><target>character</target></background><importantMessage>true</importantMessage></jasbro.game.world.customContent.effects.WorldEventSimpleMessage></subEffects></jasbro.game.world.customContent.effects.WorldEventEffectContainer></subEffects><requirement class="jasbro.game.world.customContent.requirements.CodeRequirement"><code>return place == 1;</code></requirement></jasbro.game.world.customContent.effects.WorldEventCondition><jasbro.game.world.customContent.effects.WorldEventSetQuestStatus><questStatus>SOLVED</questStatus></jasbro.game.world.customContent.effects.WorldEventSetQuestStatus><jasbro.game.world.customContent.effects.WorldEventCode><code>//Make sure character can't be used during next competitions
cooldown = new CoolDown(45, "contest", "Contest participation", "Participated in a contest and won't be able to do so for a little while.");
character.addCondition(cooldown);

data.earnMoney(priceMoney, "Bartender contest");</code><displayHeight>1</displayHeight></jasbro.game.world.customContent.effects.WorldEventCode></subEffects></jasbro.game.world.customContent.effects.WorldEventEffectContainer></effects></jasbro.game.world.customContent.WorldEvent>